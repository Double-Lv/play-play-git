## 当你在主分支误改了文件

最近阮老师又双叒叕被怼了，原因是他发布的这条微博：

使用reset --hard的风险在于，它会直接丢弃掉工作区和暂存区的改动，如未提交过就再也找不回来了。如果撤销的全是你的错误代码还好，一旦还包含主分支的正常代码，那么这部分代码也就找不回来了。

所以阮老师的这个git小窍门被指夺命。抛开微博上的明嘲暗讽，我们严肃讨论下这个问题：当你在主分支误改了代码，该如何优雅的处理呢？

大家知道git是分为工作区、暂存区、本地仓库、远程仓库这几个概念的，那么我们就得分情况来讨论了。

### 还未添加到暂存区

这种情况比较好办，直接git checkout -b new_branch，这样你的改动会被带到新分支。然后把主分支的修改用git checkout -- <file>给恢复就行了。

另一种方法是先git stash，然后git checkout new_branch，再新分支git stash pop即可。这种方式最好理解，就是把改动先放到一个临时区域，让git先别管，到了正确的分支再拿出来。我经常用的就是这招。

### 已添加到暂存区还未提交

这种情况和上面一样，两种方法同样适用。

### 已提交到本地仓库

这种情况就要有reset了，用git reset HEAD^撤销最近一次提交，如果有多次提交的话，查找到对应提交id进行reset就行。git默认的是mixed模式，即撤销暂存区，保留工作区。这样你再切分支也还能把改动带过去。当然加--soft也可以，这样能保留暂存区和工作区。

### 已push到远程仓库

如果很不幸你已经把误修改给push了，你需要用到revert命令，先用git log查找到你误提交的commitId，然后git revert commitId，产生一次逆向提交，来对冲掉之前的。之后再push到远程就可以了。


